"use strict";$(document).ready(function(){Utils.backTop(),Utils.modalSelect(),Utils.headerDropMenu(),Utils.getSMSCode(),Utils.renewCaptcha(),Utils.followOrUn(),Utils.starTopic(),Utils.collectTopic(),Utils.deleteReply(),Utils.editReply(),Utils.upReply(),Utils.replyReply()}),function(e,t,i){var s={backTop:function(){i(e).scroll(function(){100<i(e).scrollTop()?i(".back-top").fadeIn():i(".back-top").fadeOut()}),i(".back-top").click(function(){return i("html, body").animate({scrollTop:0},500),!1})},modalSelect:function(){i(".select").click(function(){i(".select>.options").slideToggle()}),i(".option").click(function(){i(".select-hidden").val(i(this).attr("data-value")),i(".select>.placeholder").text(i(this).text())})},headerDropMenu:function(){i(".header .info").hover(function(){i(".drop-menus").stop(!0,!1).slideToggle()})},globalMessage:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"error",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2e3;i(".global-message .message").fadeIn(),i(".global-message .message .content").addClass(e).text(t).fadeIn(),setTimeout(function(){i(".global-message .message").fadeOut()},s)},getSMSCode:function(){var s,e=i(".getcode"),l=i("#mobile"),a=i("#piccaptcha"),o=60,c=i(".alert");e.click(function(){if(i(this).hasClass("disabled"))return!1;if(!l.val()||!/^1[3,5,7,8,9]\d{9}$/.test(l.val()))return c.text("请填写正确的手机号").slideDown(),!1;if(!a.val()||5!==a.val().length)return c.text("请填写正确格式的图形验证码").slideDown(),!1;function t(){if(o--,e.addClass("disabled").text("请"+o+"s后重试"),0===o)return e.removeClass("disabled").text("获取验证码"),clearInterval(s),!1}i.getJSON("/captcha/sms?piccaptcha="+a.val()+"&mobile="+l.val(),function(e){if(1!==e.status)return c.text(e.message).slideDown(),!1;s=setInterval(t,1e3)})})},renewCaptcha:function(){var t=i(".captcha"),s=i(".alert");t.click(function(){i.getJSON("/captcha/pic",function(e){if(1!==e.status)return s.text(e.message).slideDown(),!1;t.attr("src",e.data)})})},followOrUn:function(){var s=this;i(".action.follow_user").click(function(){var t=this;i.post(e.location.pathname+"/follow_or_un",function(e){1===e.status?"follow"===e.action?(s.globalMessage("success","关注成功"),i(t).text("取消关注")):(s.globalMessage("success","取消关注"),i(t).text("关注")):s.globalMessage("error",e.message)})})},starTopic:function(){var s=this;i(".action.star_topic").click(function(){var t=this;i.post(e.location.pathname+"/star_or_un",function(e){1===e.status?"star"===e.action?(s.globalMessage("success","喜欢了该话题"),i(t).children(".number").text(parseInt(i(".action.star_topic .number").text())+1),i(t).addClass("active")):(s.globalMessage("success","取消喜欢该话题"),i(t).children(".number").text(parseInt(i(".action.star_topic .number").text())-1),i(t).removeClass("active")):s.globalMessage("error",e.message)})})},collectTopic:function(){var s=this;i(".action.collect_topic").click(function(){var t=this;i.post(e.location.pathname+"/collect_or_un",function(e){1===e.status?"collect"===e.action?(s.globalMessage("success","收藏了该话题"),i(t).children(".number").text(parseInt(i(".action.collect_topic .number").text())+1),i(t).addClass("active")):(s.globalMessage("success","取消收藏该话题"),i(t).children(".number").text(parseInt(i(".action.collect_topic .number").text())-1),i(t).removeClass("active")):s.globalMessage("error",e.message)})})},deleteReply:function(){var s=this;i(".action.delete_reply").click(function(){var t=this,e=i(this).attr("data-id");i.post("/reply/"+e+"/delete",function(e){1===e.status?(s.globalMessage("success","删除回复成功"),i(t).parents("li").remove()):s.globalMessage("error","删除回复失败")})})},editReply:function(){i(".action.edit_reply").click(function(){i(".reply-form.reply_reply_form").slideUp(),i(".reply-form.edit_reply_form").slideUp(),i(this).siblings(".reply-form.edit_reply_form").slideDown()})},upReply:function(){var s=this;i(".action.up_reply").click(function(){var e=i(this).attr("data-id"),t=this;i.post("/reply/"+e+"/up",function(e){1===e.status?"up"===e.action?(s.globalMessage("success","点赞成功"),i(t).children("span").text(parseInt(i(".action.up_reply span").text()+1))):(s.globalMessage("success","取消点赞成功"),i(t).children("span").text(parseInt(i(".action.up_reply span").text()-1))):s.globalMessage("error",e.messsage)})})},replyReply:function(){i(".action.reply_reply").click(function(){i(".reply-form.edit_reply_form").slideUp(),i(".reply-form.reply_reply_form").slideUp(),i(this).siblings(".reply-form.reply_reply_form").slideDown()})}};e.Utils=s}(window,document,jQuery);